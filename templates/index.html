<!--
Feature Status Tracker Documentation

Overview:
This HTML template implements a feature status tracking interface with interactive cards, charts, and comparison views.

Components:
1. Header Section
   - Title: Feature Status Tracker
   - Dependencies: Chart.js library, custom CSS stylesheet

2. Control Panel
   - Expand All button: Shows all feature details
   - Collapse All button: Hides all feature details
   - SVG icons for visual representation

3. Statistics Cards
   - Supported Features Card: Shows count of implemented features
   - Chart Card: Displays doughnut chart visualization
   - Features to Enhance Card: Shows count of pending enhancements

4. Feature Comparisons Section
   - Expandable feature cards
   - Two-column layout showing supported and enhancement details
   - Interactive toggle functionality

JavaScript Functions:
1. toggleFeature(header)
   - Purpose: Toggles visibility of feature details
   - Parameters: header - DOM element of feature header
   - Behavior: Expands/collapses feature details with animation

2. toggleAllFeatures(expand)
   - Purpose: Controls visibility of all feature cards
   - Parameters: expand - boolean flag for expand/collapse
   - Behavior: Expands or collapses all feature cards simultaneously

3. highlightFeatures(type)
   - Purpose: Highlights features based on category
   - Parameters: type - 'supported' or 'enhance'
   - Behavior: Highlights and expands relevant feature cards

4. Chart Initialization
   - Type: Doughnut chart
   - Data: Supported vs Enhancement features
   - Error handling: Comprehensive error checking
   - Tooltip: Shows count and percentage

Template Variables:
- stats.supported: Count of supported features
- stats.to_enhance: Count of features needing enhancement
- feature_comparisons: Dictionary of feature comparison data

CSS Dependencies:
- style.css: Custom styling for components
-->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feature Status Tracker</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <h1>✓ Feature Status Tracker</h1>
        
        <div class="controls">
            <button class="control-btn" onclick="toggleAllFeatures(true)">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="M4 9h16M4 15h16" stroke-width="2" stroke-linecap="round"/>
                </svg>
                Expand All
            </button>
            <button class="control-btn" onclick="toggleAllFeatures(false)">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="M19 9l-7 7-7-7" stroke-width="2" stroke-linecap="round"/>
                </svg>
                Collapse All
            </button>
        </div>
        
        <div class="stats-cards">
            <div class="card supported" data-type="supported" onclick="highlightFeatures('supported')">
                <div class="card-header">
                    <span class="check-icon">✓</span> Supported Features
                </div>
                <div class="card-content">
                    <div class="number">{{ stats.supported }}</div>
                    <div class="subtitle">implemented features</div>
                </div>
            </div>

            <div class="card chart">
                <canvas id="featureChart"></canvas>
                <div class="legend">
                    <span class="legend-item">
                        <span class="dot supported"></span> Supported
                    </span>
                    <span class="legend-item">
                        <span class="dot enhance"></span> Need Enhancement
                    </span>
                </div>
            </div>

            <div class="card enhance" data-type="enhance" onclick="highlightFeatures('enhance')">
                <div class="card-header">
                    <span class="enhance-icon">⟲</span> Features to Enhance
                </div>
                <div class="card-content">
                    <div class="number">{{ stats.to_enhance }}</div>
                    <div class="subtitle">pending enhancements</div>
                </div>
            </div>
        </div>

        <div class="feature-comparisons">
            {% for feature_name, comparison in feature_comparisons.items() %}
            <div class="feature-card">
                <div class="feature-header" onclick="toggleFeature(this)">
                    <h3>{{ feature_name }}</h3>
                    <span class="expand-icon">▼</span>
                </div>
                <div class="feature-details">
                    <div class="comparison-grid">
                        <div class="supported-column">
                            <h4>Supported</h4>
                            {% if comparison.supported %}
                            <p>{{ comparison.supported }}</p>
                            {% else %}
                            <p class="na">Not Available</p>
                            {% endif %}
                        </div>
                        <div class="enhance-column">
                            <h4>Need to Enhance</h4>
                            {% if comparison.to_enhance %}
                            <p>{{ comparison.to_enhance }}</p>
                            {% else %}
                            <p class="na">Not Available</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <script>
        let chart;

        function toggleFeature(header) {
            const card = header.parentElement;
            const details = card.querySelector('.feature-details');
            
            document.querySelectorAll('.feature-card.expanded').forEach(expandedCard => {
                if (expandedCard !== card) {
                    expandedCard.classList.remove('expanded');
                    expandedCard.querySelector('.feature-details').style.maxHeight = "0";
                }
            });
            
            card.classList.toggle('expanded');
            
            if (card.classList.contains('expanded')) {
                details.style.maxHeight = details.scrollHeight + "px";
            } else {
                details.style.maxHeight = "0";
            }
        }

        function toggleAllFeatures(expand) {
            const cards = document.querySelectorAll('.feature-card');
            cards.forEach(card => {
                const details = card.querySelector('.feature-details');
                if (expand) {
                    card.classList.add('expanded');
                    details.style.maxHeight = `${details.scrollHeight}px`;
                } else {
                    card.classList.remove('expanded');
                    details.style.maxHeight = '0';
                }
            });
        }

        function highlightFeatures(type) {
            document.querySelectorAll('.feature-card').forEach(card => {
                card.classList.remove('highlighted-supported', 'highlighted-enhance');
                card.classList.remove('expanded');
                card.querySelector('.feature-details').style.maxHeight = "0";
            });
    
            document.querySelectorAll('.feature-card').forEach(card => {
                const hasSupported = card.querySelector('.supported-column p:not(.na)');
                const hasEnhance = card.querySelector('.enhance-column p:not(.na)');
                
                if (type === 'supported' && hasSupported) {
                    card.classList.add('highlighted-supported', 'expanded');
                    card.querySelector('.feature-details').style.maxHeight = 
                        card.querySelector('.feature-details').scrollHeight + "px";
                } else if (type === 'enhance' && hasEnhance) {
                    card.classList.add('highlighted-enhance', 'expanded');
                    card.querySelector('.feature-details').style.maxHeight = 
                        card.querySelector('.feature-details').scrollHeight + "px";
                }
            });
        }

        document.addEventListener('DOMContentLoaded', function() {
            const ctx = document.getElementById('featureChart');
            if (!ctx || !ctx.getContext) {
                console.error('Chart canvas element not found or context not available');
                return;
            }

            let supportedCount = 0;
            let enhanceCount = 0;

            try {
                const statsData = JSON.parse('{{ stats|tojson|safe }}');
                supportedCount = parseInt(statsData.supported) || 0;
                enhanceCount = parseInt(statsData.to_enhance) || 0;
            } catch (e) {
                console.error('Error parsing stats:', e);
                return;
            }

            // Register plugins before creating chart instance
            Chart.register({
                id: 'centerCursor',
                beforeEvent: function(chart, args) {
                    const event = args.event;
                    if (!event || !event.native) return;
                    
                    const rect = chart.canvas.getBoundingClientRect();
                    const x = event.native.clientX - rect.left;
                    const y = event.native.clientY - rect.top;
                    const centerX = chart.chartArea.width / 2;
                    const centerY = chart.chartArea.height / 2;
                    const radius = Math.min(chart.chartArea.width, chart.chartArea.height) * 0.25;
                    
                    const distance = Math.sqrt(Math.pow(x - centerX, 2) + Math.pow(y - centerY, 2));
                    
                    chart.canvas.style.cursor = distance < radius ? 'pointer' : 'default';
                }
            });

            Chart.register({
                id: 'centerText',
                beforeDraw: function(chart) {
                    const width = chart.width;
                    const height = chart.height;
                    const ctx = chart.ctx;
                    const total = supportedCount + enhanceCount;
                    
                    ctx.save();
                    ctx.textBaseline = "middle";
                    ctx.textAlign = "center";
                    
                    ctx.font = "bold 32px 'Segoe UI'";
                    ctx.fillStyle = "#ffffff";
                    ctx.fillText(total, width/2, height/2 - 15);
                    
                    ctx.font = "16px 'Segoe UI'";
                    ctx.fillStyle = "#a3a3a3";
                    ctx.fillText("Total Features", width/2, height/2 + 15);
                    
                    const completionRate = total > 0 ? ((supportedCount / total) * 100).toFixed(0) : "0";
                    ctx.font = "14px 'Segoe UI'";
                    ctx.fillStyle = "#34d399";
                    ctx.fillText(`${completionRate}% Complete`, width/2, height/2 + 40);
                    
                    ctx.restore();
                }
            });

            // Create chart instance after registering plugins
            // Replace the chart options section with this updated version
            chart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Supported', 'Need Enhancement'],
                    datasets: [{
                        data: [supportedCount, enhanceCount],
                        backgroundColor: ['#34d399', '#fb923c'],
                        borderWidth: 2,
                        borderColor: '#2d3035',
                        hoverBorderColor: '#ffffff',
                        hoverBorderWidth: 4,
                        hoverOffset: 10,
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    cutout: '75%',
                    onClick: function(event, elements) {
                        if (!event.native) return;
                        
                        const rect = chart.canvas.getBoundingClientRect();
                        const x = event.native.clientX - rect.left;
                        const y = event.native.clientY - rect.top;
                        const centerX = chart.width / 2;
                        const centerY = chart.height / 2;
                        const radius = Math.min(chart.width, chart.height) * 0.3;
                        
                        const distance = Math.sqrt(
                            Math.pow(x - centerX, 2) + 
                            Math.pow(y - centerY, 2)
                        );
                        
                        if (distance < radius) {
                            // Reset all highlights and collapse all features
                            document.querySelectorAll('.feature-card').forEach(card => {
                                card.classList.remove('highlighted-supported', 'highlighted-enhance', 'expanded');
                                const details = card.querySelector('.feature-details');
                                details.style.maxHeight = '0';
                            });
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(45, 48, 53, 0.9)',
                            titleFont: {
                                size: 16,
                                weight: 'bold'
                            },
                            bodyFont: {
                                size: 14
                            },
                            padding: 12,
                            cornerRadius: 8,
                            callbacks: {
                                label: function(context) {
                                    const total = supportedCount + enhanceCount;
                                    const percentage = ((context.raw / total) * 100).toFixed(1);
                                    return `${context.label}: ${context.raw} (${percentage}%)`;
                                }
                            }
                        }
                    },
                    animation: {
                        animateScale: true,
                        animateRotate: true,
                        duration: 1000
                    }
                }
            });
            
            // Add this to the centerText plugin to make the text clickable
            Chart.register({
                id: 'centerText',
                beforeDraw: function(chart) {
                    const width = chart.width;
                    const height = chart.height;
                    const ctx = chart.ctx;
                    const total = supportedCount + enhanceCount;
                    
                    ctx.save();
                    ctx.textBaseline = "middle";
                    ctx.textAlign = "center";
                    
                    ctx.font = "bold 32px 'Segoe UI'";
                    ctx.fillStyle = "#ffffff";
                    ctx.fillText(total, width/2, height/2 - 15);
                    
                    ctx.font = "16px 'Segoe UI'";
                    ctx.fillStyle = "#a3a3a3";
                    ctx.fillText("Total Features", width/2, height/2 + 15);
                    
                    const completionRate = total > 0 ? ((supportedCount / total) * 100).toFixed(0) : "0";
                    ctx.font = "14px 'Segoe UI'";
                    ctx.fillStyle = "#34d399";
                    ctx.fillText(`${completionRate}% Complete`, width/2, height/2 + 40);
                    
                    ctx.restore();
                }
            });
        });
    </script>
</body>
</html>
